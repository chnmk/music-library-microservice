# Сервис для библиотеки песен
Получает, возвращает, меняет и удаляет данные о песнях в соответствии с запросами. Получает тексты песен запросами к стороннему API. Сохраняет резервную копию данных в PostgreSQL.

## Содержание
1. [Функционал](#функционал)
2. [Запуск через Docker](#запуск-через-docker)
3. [Переменные окружения](#переменные-окружения)
4. [Тестирование](#тестирование)

## Функционал

Полученные данные о песнях хранятся в мапе, где ключом является порядковый ID. Когда клиент запрашивает данные библиотеки, они возвращаются вместе с ID песен. По этому же ID можно производить удаление и изменение информации о песнях.

При запросе данных из библиотеки есть возможность фильтрации по имени исполнителя, названию песни и тексту. Также есть возможность запросить конкретную страницу результатов, а не все сразу. Количество песен на одной странице определяется переменной окружения `PAGE_SIZE` (по умолчанию `10`).

Хранение песен в мапе обеспечивает более быстрое добавление, удаление и изменение, а также более быстрое получение текста конкретной песни. Однако уменьшается скорость возврата всей библиотеки, поскольку порядковые ID (ключи мапы) приходится дополнительно сортировать.

Информация о текстах песен запрашивается из стороннего API. Резервное хранение данных производится через PostgreSQL.

Логирование реализовано через `slog`.

## Запуск через Docker

Сервис можно запустить через Docker Compose вместе с PostgreSQL (файл `compose.yaml`). Для запуска рекомендуется использовать команду `docker compose up --attach orders`. Необходимые переменные окружения:

```
# Указаны значения по умолчанию
POSTGRES_USER=user
POSTGRES_PASSWORD=12345
POSTGRES_DB=orders
```

## Переменные окружения
Список переменных окружения со стандартными значениями:

```
# Порт, на котором будет поднят сервер
SERVER_PORT = 3000

# Адрес сервера для получения текста песен и максимальное время запроса в секундах 
REQUEST_SERVER = localhost:3001
REQUEST_TIMEOUT = 1

# Строка подключения к БД формируется следующим образом:
# DB_PROTOCOL://POSTGRES_USER:POSTGRES_PASSWORD@DB_HOST:DB_PORT/POSTGRES_DB
POSTGRES_USER=user
POSTGRES_PASSWORD=12345
POSTGRES_DB=muslib

# Для запуска через Docker Compose эти переменные необходимо указать в любом случае
DB_PROTOCOL=postgres
DB_HOST=postgres
DB_PORT=5432 
SSL_MODE=disable

# Настройки самого сервиса
LOG_LEVEL = debug # либо info
MAX_ENTRIES = 10000 # максимальное количество песен в памяти
RESTORE_FROM_DB = true # восстанавливать ли песни из БД при запуске
PAGE_SIZE = 10 # количество песен в одной странице
```


## Тестирование

Написаны автотесты на пакеты transport, services, database. Запуск тестов:

```
go test ./...
```